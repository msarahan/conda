#!/bin/sh
#
# `source deactivate` initial conditional check to determine which `source deactivate` to actually run
#
# assumes that deactivate.* can be found on the $PATH
#

# error clause
echo `ps -p $$ | sed 's|.*csh|THIS-IS-CSH|' | grep CSH || eval echo '$0'`                           \
     "`ps -p $$ | tr '\n' ' '`"                                                                     \
     "`test -x /usr/bin/lsb_release && lsb_release -si || uname -s`"                                \
     "$SHLVL"                                                                                       \
     "deactivate"                                                                                   \
     "error-clause" | awk -f "`which .de.activate.clauses`"                                         &&\
bash -c "echo '[DEACTIVATE]: ERROR: Only supports sourcing from tcsh/csh and bash/zsh/dash.' 1>&2"

# bourne shell clause (bash/zsh/dash)
echo `ps -p $$ | sed 's|.*csh|THIS-IS-CSH|' | grep CSH || eval echo '$0'`                           \
     "`ps -p $$ | tr '\n' ' '`"                                                                     \
     "`test -x /usr/bin/lsb_release && lsb_release -si || uname -s`"                                \
     "$SHLVL"                                                                                       \
     "deactivate"                                                                                   \
     "bourne-shell-clause" | awk -f "`which .de.activate.clauses`"                                  &&\
. "`which deactivate.sh`" && return

# c-shell clause (tcsh/csh)
echo `ps -p $$ | sed 's|.*csh|THIS-IS-CSH|' | grep CSH || eval echo '$0'`                           \
     "`ps -p $$ | tr '\n' ' '`"                                                                     \
     "`test -x /usr/bin/lsb_release && lsb_release -si || uname -s`"                                \
     "$SHLVL"                                                                                       \
     "deactivate"                                                                                   \
     "c-shell-clause" | awk -f "`which .de.activate.clauses`"                                       &&\
source "`which deactivate.csh`" && exit $status
