#!/bin/sh
#
# `source deactivate` initial conditional check to determine which `source deactivate` to actually run
#
# assumes that deactivate.* can be found on the $PATH
#

# error clause
echo `ps -p $$ | sed 's|.*csh|THIS-IS-CSH|' | grep CSH || eval echo '$0'`                           \
     "`ps -p $$ | tr '\n' ' '`"                                                                     \
     "`test -x /usr/bin/lsb_release && lsb_release -si | sed 's| ||' || uname -s`"                  \
     "$SHLVL"                                                                                       \
     "deactivate"                                                                                   \
     "error-clause" | awk -f "`which whichshell.awk`"                                               &&\
bash -c "echo '[DEACTIVATE]: ERROR: Only supports sourcing from tcsh/csh and bash/zsh/dash/posh.' 1>&2"

# bourne shell clause (bash/zsh/dash/posh)
echo `ps -p $$ | sed 's|.*csh|THIS-IS-CSH|' | grep CSH || eval echo '$0'`                           \
     "`ps -p $$ | tr '\n' ' '`"                                                                     \
     "`test -x /usr/bin/lsb_release && lsb_release -si | sed 's| ||' || uname -s`"                  \
     "$SHLVL"                                                                                       \
     "deactivate"                                                                                   \
     "bourne-shell-clause" | awk -f "`which whichshell.awk`"                                        &&\
. "`which deactivate.sh`" && return

# c-shell clause (tcsh/csh)
echo `ps -p $$ | sed 's|.*csh|THIS-IS-CSH|' | grep CSH || eval echo '$0'`                           \
     "`ps -p $$ | tr '\n' ' '`"                                                                     \
     "`test -x /usr/bin/lsb_release && lsb_release -si | sed 's| ||' || uname -s`"                  \
     "$SHLVL"                                                                                       \
     "deactivate"                                                                                   \
     "c-shell-clause" | awk -f "`which whichshell.awk`"                                             &&\
source "`which deactivate.csh`" && exit $status
